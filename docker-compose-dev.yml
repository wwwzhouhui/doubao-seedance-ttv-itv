version: '3.8'

# 开发环境配置 - 本地构建镜像
services:
  doubao-seedance:
    build:
      context: .
      dockerfile: Dockerfile
    image: doubao-seedance:latest
    container_name: doubao-seedance
    restart: unless-stopped
    ports:
      - "7860:7860"  # Gradio 前端
      - "8000:8000"  # API 后端 (开发环境暴露便于调试)
    environment:
      # 豆包API配置
      - DOUBAO_BASE_URL=https://doubao.happieapi.top
      - DOUBAO_SESSION_COOKIE=${DOUBAO_SESSION_COOKIE}
      # API鉴权Token (可选，不配置则不启用鉴权)
      - AUTH_TOKEN=${AUTH_TOKEN}
      # 内置API配置 (容器内部通信，提供视频代理等功能)
      - API_BASE_URL=http://localhost:8000
      - API_HOST=0.0.0.0
      - API_PORT=8000
      - ENABLE_INTERNAL_API=true
      # Gradio配置
      - GRADIO_PORT=7860
      - TZ=Asia/Shanghai
    env_file:
      - .env
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7860/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
